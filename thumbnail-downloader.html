<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Thumbnail Downloader & Compressor</title>
  <style>
    :root{--brand:#007bff;--bg:#ffffff;--muted:#6b7280}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial; background:linear-gradient(180deg,#f7fbff 0%,#ffffff 100%); color:#0f172a}
    .container{max-width:980px;margin:20px auto;padding:18px;border-radius:14px;background:var(--bg);box-shadow:0 8px 30px rgba(3,27,77,0.06)}
    header{display:flex;gap:12px;align-items:center}
    header h1{margin:0;font-size:18px;color:var(--brand)}
    .top{display:flex;gap:12px;flex-wrap:wrap;margin-top:12px}
    .card{flex:1;min-width:260px;padding:12px;border-radius:12px;background:linear-gradient(180deg,#ffffff,#fbfdff);border:1px solid rgba(0,123,255,0.06)}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type="text"],select{width:100%;padding:10px;border-radius:8px;border:1px solid #e6eefb;background:#fbfdff}
    .row{display:flex;gap:8px;align-items:center}
    button{background:var(--brand);color:#fff;padding:10px 12px;border-radius:10px;border:0;cursor:pointer}
    button.secondary{background:#eef6ff;color:var(--brand);border:1px solid rgba(0,123,255,0.12)}
    .preview-area{display:flex;gap:12px;flex-wrap:wrap;align-items:flex-start;margin-top:14px}
    .preview{flex:1;min-width:260px;display:flex;flex-direction:column;gap:8px;align-items:center}
    img#mainThumb{max-width:100%;border-radius:10px;border:1px solid #e6eefb}
    canvas{display:none}
    .filters{display:flex;gap:8px;flex-wrap:wrap}
    .filter-pill{padding:8px 10px;border-radius:999px;border:1px solid rgba(0,123,255,0.08);background:#fff;cursor:pointer}
    .filter-pill.active{background:var(--brand);color:#fff}
    .thumb-row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .thumb-card{flex:1;min-width:140px;padding:8px;border-radius:10px;background:#f8fbff;border:1px solid rgba(0,123,255,0.04);text-align:center}
    .thumb-card img{max-width:100%;border-radius:6px}
    .controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .small{font-size:12px;color:var(--muted)}
    input[type=file]{display:none}
    .upload-label{display:inline-block;padding:8px 10px;border-radius:8px;border:1px dashed rgba(0,0,0,0.06);cursor:pointer}
    footer{margin-top:14px;font-size:12px;color:var(--muted)}

    /* Responsive */
    @media (max-width:700px){
      .top{flex-direction:column}
      header h1{font-size:16px}
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='40' height='40'><rect rx='8' ry='8' width='40' height='40' fill='%23007bff'/><text x='50%' y='55%' fill='white' font-size='20' font-family='Arial' text-anchor='middle'>YT</text></rect></svg>" alt="logo" style="width:44px;height:44px;border-radius:10px;"/>
      <div>
        <h1>Thumbnail Downloader & Compressor</h1>
        <div class="small">Paste YouTube link — thumbnail auto-generates. Upload images, compress, preview & download. Mobile-friendly.</div>
      </div>
    </header>

    <div class="top">
      <div class="card">
        <label for="ytUrl">YouTube Video URL</label>
        <input id="ytUrl" type="text" placeholder="Paste YouTube link here (or just video id)" />
        <div style="height:8px"></div>
        <label for="quality">Quality</label>
        <select id="quality">
          <option value="maxresdefault">Max (maxresdefault)</option>
          <option value="sddefault">SD (sddefault)</option>
          <option value="hqdefault">HQ (hqdefault)</option>
        </select>
        <div style="height:10px"></div>
        <div class="controls">
          <button id="fetchBtn">Generate Thumbnail</button>
          <label class="upload-label" for="uploadInput">Upload Image</label>
          <input id="uploadInput" type="file" accept="image/*" />
          <button class="secondary" id="resetBtn">Reset</button>
        </div>
        <div style="height:8px"></div>
        <label class="small">Compression Quality</label>
        <input id="qualityRange" type="range" min="0.2" max="1" step="0.05" value="0.85" />
      </div>

      <div class="card">
        <label>Preview</label>
        <div class="preview-area">
          <div class="preview" style="flex-basis:48%">
            <img id="mainThumb" src="" alt="thumbnail preview" />
            <canvas id="workCanvas"></canvas>
            <div class="filters small">Filters: <div style="height:6px"></div>
              <div class="filters" id="filterList">
                <div class="filter-pill active" data-filter="none">Original</div>
                <div class="filter-pill" data-filter="grayscale(100%)">Grayscale</div>
                <div class="filter-pill" data-filter="sepia(60%)">Sepia</div>
              </div>
            </div>
            <div style="height:8px"></div>
            <div class="row" style="width:100%">
              <button id="downloadFiltered">Download Filtered</button>
              <button id="downloadOriginal" class="secondary">Download Original</button>
            </div>
          </div>

          <div class="preview" style="flex-basis:48%">
            <label class="small">Three quick filtered previews (download each)</label>
            <div class="thumb-row" id="threePreviews">
              <!-- generated previews -->
            </div>
            <div style="height:6px"></div>
            <div class="small">Tip: Paste link and the thumbnail will auto-generate. Use compression slider before downloading compressed versions.</div>
          </div>
        </div>
      </div>
    </div>

    <footer>Made with ❤️ — Bright blue & white theme. Works on mobile.</footer>
  </div>

<script>
(function(){
  const ytInput = document.getElementById('ytUrl');
  const fetchBtn = document.getElementById('fetchBtn');
  const qualitySelect = document.getElementById('quality');
  const mainImg = document.getElementById('mainThumb');
  const canvas = document.getElementById('workCanvas');
  const qRange = document.getElementById('qualityRange');
  const uploadInput = document.getElementById('uploadInput');
  const resetBtn = document.getElementById('resetBtn');
  const filterList = document.getElementById('filterList');
  const threePreviews = document.getElementById('threePreviews');
  const downloadFiltered = document.getElementById('downloadFiltered');
  const downloadOriginal = document.getElementById('downloadOriginal');

  let currentImage = null; // HTMLImageElement
  let currentFilter = 'none';

  // utils
  function parseYouTubeID(url){
    if(!url) return null;
    // allow raw id
    if(/^[a-zA-Z0-9_-]{11}$/.test(url)) return url;
    const regex = /(?:v=|\/)([0-9A-Za-z_-]{11})/;
    const m = url.match(regex);
    if(m) return m[1];
    return null;
  }

  function buildThumbURL(id, quality){
    return `https://img.youtube.com/vi/${id}/${quality}.jpg`;
  }

  function loadImage(url, cb){
    const img = new Image();
    img.crossOrigin = 'anonymous'; // try to avoid CORS blocking for canvas
    img.onload = ()=>cb(null,img);
    img.onerror = (e)=>cb(new Error('Failed to load image'),null);
    img.src = url + (url.indexOf('?')===-1? '?_=' + Date.now() : '&_=' + Date.now());
  }

  function showMainImage(img){
    currentImage = img;
    mainImg.src = img.src;
    mainImg.style.filter = 'none';
    generateThreePreviews();
  }

  function drawToCanvas(img, filter){
    const maxW = Math.min(img.width, 1920);
    const scale = Math.min(1, maxW / img.width || 1);
    canvas.width = Math.round(img.width * scale);
    canvas.height = Math.round(img.height * scale);
    const ctx = canvas.getContext('2d');
    ctx.filter = filter || 'none';
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.drawImage(img,0,0,canvas.width,canvas.height);
  }

  function downloadCanvas(filename, quality){
    return new Promise((resolve,reject)=>{
      canvas.toBlob(function(blob){
        if(!blob) return reject(new Error('Failed to export'));
        const a = document.createElement('a');
        const url = URL.createObjectURL(blob);
        a.href = url; a.download = filename;
        document.body.appendChild(a); a.click();
        a.remove();
        setTimeout(()=>URL.revokeObjectURL(url),1500);
        resolve();
      }, 'image/jpeg', quality===undefined? 0.85 : quality);
    });
  }

  // auto-generate on paste and input
  function tryAutoGenerate(){
    const id = parseYouTubeID(ytInput.value.trim());
    if(!id) return;
    const q = qualitySelect.value;
    const url = buildThumbURL(id, q);
    // load
    loadImage(url, (err,img)=>{
      if(err){
        // fallback to hqdefault
        if(q!=='hqdefault'){
          loadImage(buildThumbURL(id,'hqdefault'), (e2,im2)=>{ if(!e2) showMainImage(im2); });
        }
        return;
      }
      showMainImage(img);
    });
  }

  // generate three filtered previews and download buttons
  function generateThreePreviews(){
    threePreviews.innerHTML='';
    if(!currentImage) return;
    const presets = [
      {name:'Original', filter:'none'},
      {name:'Grayscale', filter:'grayscale(100%)'},
      {name:'Sepia', filter:'sepia(60%)'}
    ];
    presets.forEach(p=>{
      const card = document.createElement('div'); card.className='thumb-card';
      const img = document.createElement('img');
      // draw small preview via temporary canvas
      const tmp = document.createElement('canvas');
      const ctx = tmp.getContext('2d');
      const w = 320; const h = Math.round(currentImage.height * (w/currentImage.width));
      tmp.width=w; tmp.height=h; ctx.filter = p.filter; ctx.drawImage(currentImage,0,0,w,h);
      img.src = tmp.toDataURL('image/jpeg',0.9);
      const title = document.createElement('div'); title.className='small'; title.style.marginTop='6px'; title.textContent = p.name;
      const dl = document.createElement('button'); dl.style.marginTop='8px'; dl.textContent='Download';
      dl.onclick = ()=>{
        // draw on main canvas fullsize with filter
        drawToCanvas(currentImage, p.filter);
        downloadCanvas(`${p.name.replace(/\s+/g,'_')}_thumbnail.jpg`, parseFloat(qRange.value));
      };
      card.appendChild(img); card.appendChild(title); card.appendChild(dl);
      threePreviews.appendChild(card);
    });
  }

  // event handlers
  fetchBtn.addEventListener('click', tryAutoGenerate);
  qualitySelect.addEventListener('change', tryAutoGenerate);
  ytInput.addEventListener('input', ()=>{
    // try to generate quickly if looks like id/URL
    tryAutoGenerate();
  });
  ytInput.addEventListener('paste', (e)=>{
    setTimeout(tryAutoGenerate,50);
  });

  uploadInput.addEventListener('change', (ev)=>{
    const f = ev.target.files && ev.target.files[0];
    if(!f) return;
    const reader = new FileReader();
    reader.onload = function(){
      const img = new Image();
      img.onload = ()=>{
        // downscale moderately for performance
        const maxDim = 1400;
        let w=img.width,h=img.height; const ratio=Math.min(1, maxDim/Math.max(w,h));
        if(ratio<1){ w=Math.round(w*ratio); h=Math.round(h*ratio); }
        const tmp = document.createElement('canvas'); tmp.width=w; tmp.height=h; const ctx=tmp.getContext('2d'); ctx.drawImage(img,0,0,w,h);
        const down = new Image(); down.onload = ()=>{ showMainImage(down); };
        down.src = tmp.toDataURL('image/jpeg', parseFloat(qRange.value));
      };
      img.src = reader.result;
    };
    reader.readAsDataURL(f);
  });

  resetBtn.addEventListener('click', ()=>{
    ytInput.value=''; mainImg.src=''; currentImage=null; threePreviews.innerHTML='';
  });

  filterList.addEventListener('click',(e)=>{
    const pill = e.target.closest('.filter-pill'); if(!pill) return;
    // toggle active
    [...filterList.querySelectorAll('.filter-pill')].forEach(p=>p.classList.remove('active'));
    pill.classList.add('active');
    currentFilter = pill.dataset.filter || 'none';
    if(currentImage){
      // apply CSS filter for preview img
      mainImg.style.filter = currentFilter;
      // draw to canvas with filter for downloads
      drawToCanvas(currentImage, currentFilter);
    }
  });

  downloadFiltered.addEventListener('click', async ()=>{
    if(!currentImage) return alert('No image loaded');
    drawToCanvas(currentImage, currentFilter);
    await downloadCanvas('filtered_thumbnail.jpg', parseFloat(qRange.value));
  });
  downloadOriginal.addEventListener('click', async ()=>{
    if(!currentImage) return alert('No image loaded');
    // draw without filters
    drawToCanvas(currentImage, 'none');
    await downloadCanvas('original_thumbnail.jpg', parseFloat(qRange.value));
  });

  // small UX: double-click a generated preview to set as main image
  threePreviews.addEventListener('dblclick',(e)=>{
    const img = e.target.closest('.thumb-card')?.querySelector('img');
    if(img) showMainImage(Object.assign(new Image(), {src:img.src, width:img.naturalWidth, height:img.naturalHeight}));
  });

  // initialize canvas for downloads even if image arrives later
  canvas.width = 1; canvas.height = 1;

})();
</script>
</body>
</html>
