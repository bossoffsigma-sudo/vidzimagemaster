<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blue Cropper Tool</title>
  <style>
    body {
      margin: 0; font-family: Arial, sans-serif;
      background: #f5faff; color: #003366;
    }
    header {
      background: #1890ff; color: #fff;
      padding: 15px; font-size: 20px;
      font-weight: bold; text-align: center;
    }
    .container { max-width: 1000px; margin: 20px auto; padding: 10px; }
    .uploader {
      border: 2px dashed #1890ff; padding: 20px;
      text-align: center; background: #fff;
      border-radius: 12px; margin-bottom: 20px;
    }
    .uploader input { display: none; }
    .btn {
      background: #1890ff; color: #fff; border: none;
      padding: 10px 16px; border-radius: 8px;
      cursor: pointer; font-weight: bold; margin: 5px;
    }
    .workspace {
      position: relative; display: flex;
      justify-content: center; align-items: center;
      background: #fff; border: 1px solid #ddd;
      border-radius: 12px; min-height: 300px; overflow: hidden;
    }
    #sourceImage { max-width: 100%; max-height: 70vh; display: none; }
    #cropBox {
      position: absolute; border: 2px dashed #1890ff;
      display: none; box-sizing: border-box;
    }
    .handle {
      width: 12px; height: 12px;
      background: #1890ff; border: 2px solid #fff;
      border-radius: 50%; position: absolute; cursor: pointer;
    }
    .handle.nw { top: -6px; left: -6px; cursor: nw-resize; }
    .handle.ne { top: -6px; right: -6px; cursor: ne-resize; }
    .handle.sw { bottom: -6px; left: -6px; cursor: sw-resize; }
    .handle.se { bottom: -6px; right: -6px; cursor: se-resize; }
    .handle.n { top: -6px; left: 50%; transform: translateX(-50%); cursor: n-resize; }
    .handle.s { bottom: -6px; left: 50%; transform: translateX(-50%); cursor: s-resize; }
    .handle.w { left: -6px; top: 50%; transform: translateY(-50%); cursor: w-resize; }
    .handle.e { right: -6px; top: 50%; transform: translateY(-50%); cursor: e-resize; }
    .controls { margin: 15px 0; text-align: center; }
    select { padding: 8px; border: 2px solid #1890ff; border-radius: 6px; }
    .preview { margin-top: 20px; text-align: center; }
    canvas { max-width: 100%; border: 1px solid #ddd; border-radius: 12px; }
  </style>
</head>
<body>
  <header>âš¡ Blue & White Image Crop Tool</header>
  <div class="container">
    <div class="uploader">
      <input type="file" id="fileInput" accept="image/*" />
      <button class="btn" onclick="document.getElementById('fileInput').click()">Upload Image</button>
    </div>

    <div class="controls">
      <label>Aspect Ratio: </label>
      <select id="aspectRatio">
        <option value="free">Free</option>
        <option value="1">1:1 (Square)</option>
        <option value="4/3">4:3</option>
        <option value="3/2">3:2</option>
        <option value="2/3">2:3</option>
        <option value="35/45">35x45 (Visa)</option>
      </select>
    </div>

    <div class="workspace" id="workspace">
      <img id="sourceImage" />
      <div id="cropBox">
        <div class="handle nw"></div><div class="handle ne"></div>
        <div class="handle sw"></div><div class="handle se"></div>
        <div class="handle n"></div><div class="handle s"></div>
        <div class="handle w"></div><div class="handle e"></div>
      </div>
    </div>

    <div class="preview">
      <button class="btn" id="cropBtn">Crop</button>
      <button class="btn" id="downloadBtn">Download</button>
      <div><canvas id="preview"></canvas></div>
    </div>
  </div>

  <script>
    const fileInput = document.getElementById("fileInput");
    const sourceImage = document.getElementById("sourceImage");
    const cropBox = document.getElementById("cropBox");
    const previewCanvas = document.getElementById("preview");
    const aspectSelect = document.getElementById("aspectRatio");

    let startX, startY, startW, startH, startL, startT, action = null;
    let crop = { x: 50, y: 50, w: 150, h: 150 };

    fileInput.addEventListener("change", e => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = () => {
          sourceImage.src = reader.result;
          sourceImage.onload = () => {
            sourceImage.style.display = "block";
            crop.w = sourceImage.width / 2;
            crop.h = sourceImage.height / 2;
            crop.x = (sourceImage.width - crop.w) / 2;
            crop.y = (sourceImage.height - crop.h) / 2;
            updateCropBox();
            cropBox.style.display = "block";
          }
        }
        reader.readAsDataURL(file);
      }
    });

    function updateCropBox() {
      cropBox.style.left = crop.x + "px";
      cropBox.style.top = crop.y + "px";
      cropBox.style.width = crop.w + "px";
      cropBox.style.height = crop.h + "px";
    }

    function startResize(e, dir) {
      e.preventDefault();
      action = dir;
      startX = e.clientX || e.touches[0].clientX;
      startY = e.clientY || e.touches[0].clientY;
      startW = crop.w; startH = crop.h;
      startL = crop.x; startT = crop.y;
      document.addEventListener("mousemove", resizing);
      document.addEventListener("mouseup", stopAction);
      document.addEventListener("touchmove", resizing);
      document.addEventListener("touchend", stopAction);
    }

    function resizing(e) {
      let x = e.clientX || e.touches[0].clientX;
      let y = e.clientY || e.touches[0].clientY;
      let dx = x - startX, dy = y - startY;

      let ratio = aspectSelect.value === "free" ? null : eval(aspectSelect.value);

      if (action.includes("e")) crop.w = Math.max(20, startW + dx);
      if (action.includes("s")) crop.h = Math.max(20, startH + dy);
      if (action.includes("w")) { crop.w = Math.max(20, startW - dx); crop.x = startL + dx; }
      if (action.includes("n")) { crop.h = Math.max(20, startH - dy); crop.y = startT + dy; }

      if (ratio) {
        crop.h = crop.w / ratio;
      }

      updateCropBox();
    }

    function stopAction() {
      document.removeEventListener("mousemove", resizing);
      document.removeEventListener("mouseup", stopAction);
      document.removeEventListener("touchmove", resizing);
      document.removeEventListener("touchend", stopAction);
      action = null;
    }

    cropBox.addEventListener("mousedown", e => {
      if (e.target.classList.contains("handle")) {
        startResize(e, e.target.classList[1]);
      } else {
        startResize(e, "move");
      }
    });

    function moveBox(e) {
      if (action !== "move") return;
      let x = e.clientX || e.touches[0].clientX;
      let y = e.clientY || e.touches[0].clientY;
      crop.x = startL + (x - startX);
      crop.y = startT + (y - startY);
      updateCropBox();
    }

    document.addEventListener("mousemove", moveBox);
    document.addEventListener("touchmove", moveBox);

    document.getElementById("cropBtn").addEventListener("click", () => {
      let scaleX = sourceImage.naturalWidth / sourceImage.width;
      let scaleY = sourceImage.naturalHeight / sourceImage.height;
      let sx = crop.x * scaleX, sy = crop.y * scaleY;
      let sw = crop.w * scaleX, sh = crop.h * scaleY;
      previewCanvas.width = sw; previewCanvas.height = sh;
      previewCanvas.getContext("2d").drawImage(sourceImage, sx, sy, sw, sh, 0, 0, sw, sh);
    });

    document.getElementById("downloadBtn").addEventListener("click", () => {
      const link = document.createElement("a");
      link.download = "cropped.png";
      link.href = previewCanvas.toDataURL("image/png");
      link.click();
    });
  </script>
</body>
</html>
